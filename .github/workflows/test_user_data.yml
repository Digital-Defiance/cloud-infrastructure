name: Test user_data.sh
on:
  workflow_dispatch:
  pull_request:
    paths:
      - '.github/workflows/test_user_data.yml'
      - './k8s/coder-deployment/terraform/scripts/user_data.sh'
    branches:
      - "main"



jobs:
  test_user_data:
    runs-on: ubuntu-latest
    container:
      image: ubuntu:22.04

    steps:
    - 
      name: Checkout
      id: checkout
      uses: actions/checkout@v1

    - run: apt update
    - run: apt install curl -y

    - run:  sed -i "2a\\alias sudo=''" ./user_data.sh
      name: Add alias to mock sudo
      working-directory: ./k8s

    - run:  chmod +x ./user_data.sh 
      name: Add execute permissions
      working-directory: ./k8s

      
    - run:  ./user_data.sh
      working-directory: ./k8s

    
